<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Split PDF | I Like PDF Tools</title>
<style>
:root{
  --bg:#0f172a; --panel:#1e293b; --accent:#38bdf8; --muted:#94a3b8;
}
body{margin:0;font-family:Arial,sans-serif;background:var(--bg);color:#e2e8f0;display:flex;flex-direction:column;align-items:center;min-height:100vh;padding:12px}
header{font-size:1.5rem;font-weight:bold;color:var(--accent);margin-bottom:12px}
.card{background:var(--panel);padding:16px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.5);max-width:800px;width:100%;margin-bottom:16px}
input[type=file],input[type=text],button{padding:8px;margin:6px 0;border-radius:8px;border:none;width:100%;font-size:1rem}
button{background:var(--accent);color:var(--bg);font-weight:bold;cursor:pointer;transition:0.2s}
button:hover{background:#0ea5e9}
#preview{margin-top:8px;background:var(--bg);padding:8px;border-radius:8px;max-height:300px;overflow-x:auto;display:flex;gap:8px;flex-wrap:wrap;align-items:flex-start;justify-content:flex-start}
.preview-item{position:relative;width:80px;height:100px;border:1px solid #334155;border-radius:8px;overflow:hidden;display:flex;align-items:center;justify-content:center;flex-direction:column;padding:2px;font-size:0.75rem;text-align:center;cursor:pointer}
.preview-item.selected{border:2px solid var(--accent)}
.status{margin-top:4px;color:var(--muted)}
.progress{height:10px;background:rgba(255,255,255,0.03);border-radius:10px;overflow:hidden;margin-top:8px}
.progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),#7c3aed);width:0%}
.controls{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
</style>
</head>
<body>

<header>✂️ Split PDF Online</header>

<div class="card">
  <div class="controls">
    <input type="file" id="fileInput" accept="application/pdf">
    <input type="text" id="pageRanges" placeholder="Enter page ranges (e.g., 1,3-5)">
    <button id="splitBtn">Split PDF</button>
  </div>

  <div class="status" id="status">Idle</div>
  <div class="progress"><i id="progressBar"></i></div>
  <div id="preview"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>
const fileInput = document.getElementById('fileInput');
const pageRanges = document.getElementById('pageRanges');
const preview = document.getElementById('preview');
const splitBtn = document.getElementById('splitBtn');
const statusEl = document.getElementById('status');
const progressBar = document.getElementById('progressBar');

let pdfDocBytes = null;
let totalPages = 0;

// Load PDF and show thumbnails
fileInput.addEventListener('change', async e => {
  preview.innerHTML = '';
  pdfDocBytes = null;
  const file = e.target.files[0];
  if(!file || file.type!=='application/pdf') { statusEl.textContent='❌ Please upload a PDF'; return; }

  statusEl.textContent='Loading PDF...';
  const arrayBuffer = await file.arrayBuffer();
  pdfDocBytes = arrayBuffer;

  const pdf = await pdfjsLib.getDocument({data:arrayBuffer}).promise;
  totalPages = pdf.numPages;

  for(let i=1;i<=totalPages;i++){
    const page = await pdf.getPage(i);
    const viewport = page.getViewport({scale:0.2});
    const canvas = document.createElement('canvas');
    canvas.width = viewport.width;
    canvas.height = viewport.height;
    const ctx = canvas.getContext('2d');
    await page.render({canvasContext:ctx, viewport}).promise;

    const div = document.createElement('div');
    div.className='preview-item';
    div.dataset.page=i;
    div.appendChild(canvas);
    div.appendChild(document.createTextNode(`Page ${i}`));
    preview.appendChild(div);

    // Toggle selection on click
    div.addEventListener('click', ()=>div.classList.toggle('selected'));
  }
  statusEl.textContent=`PDF loaded (${totalPages} pages)`;
});

// Parse page ranges input
function parseRanges(input, total){
  const pages = new Set();
  input.split(',').forEach(part=>{
    const range = part.split('-').map(Number);
    if(range.length===1 && range[0]>=1 && range[0]<=total) pages.add(range[0]);
    else if(range.length===2){
      let [start,end]=range;
      start=Math.max(1,start); end=Math.min(total,end);
      for(let i=start;i<=end;i++) pages.add(i);
    }
  });
  return Array.from(pages).sort((a,b)=>a-b);
}

// Split PDF
splitBtn.addEventListener('click', async ()=>{
  if(!pdfDocBytes){ alert('No PDF loaded'); return;}
  statusEl.textContent='Splitting PDF...';
  progressBar.style.width='0%';

  const selectedDivs = Array.from(preview.getElementsByClassName('preview-item')).filter(d=>d.classList.contains('selected'));
  let pagesToExtract = [];
  if(selectedDivs.length>0){
    pagesToExtract = selectedDivs.map(d=>parseInt(d.dataset.page));
  } else {
    const ranges = pageRanges.value.trim();
    if(!ranges){ alert('Select pages or enter ranges'); return;}
    pagesToExtract = parseRanges(ranges, totalPages);
  }

  if(pagesToExtract.length===0){ alert('No valid pages selected'); return;}

  try{
    const pdf = await PDFLib.PDFDocument.load(pdfDocBytes);
    for(let i=0;i<pagesToExtract.length;i++){
      const newPdf = await PDFLib.PDFDocument.create();
      const [copied] = await newPdf.copyPages(pdf,[pagesToExtract[i]-1]);
      newPdf.addPage(copied);
      const bytes = await newPdf.save();
      const blob = new Blob([bytes],{type:'application/pdf'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download=`page_${pagesToExtract[i]}.pdf`;
      a.click();
      progressBar.style.width=`${Math.round(((i+1)/pagesToExtract.length)*100)}%`;
    }
    statusEl.textContent=`✅ Split complete (${pagesToExtract.length} PDFs)`;
  } catch(err){
    console.error(err);
    statusEl.textContent='❌ Error during split: '+err.message;
  }
});
</script>
</body>
</html>
